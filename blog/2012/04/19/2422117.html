<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>How to import your project's history in Sonar</title>
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <style type='text/css'>
      /*<![CDATA[*/
        body {
          padding-top: 60px;
          padding-bottom: 60px;
        }
      /*]]>*/
    </style>
    <link href='/stylesheets/styles.css' rel='stylesheet' type='text/css' />
    <link href='/stylesheets/prettify.css' rel='stylesheet' type='text/css' />
    <!--[if lt IE 9]>
      <script src='//html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
    <![endif]-->
    <script src=' https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js' type='text/javascript'></script>
  </head>
  <body>
    <header class='navbar navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container'>
          <div class='span3'>
            <a class='brand' href='/'>Aslak Knutsen</a>
          </div>
          <div class='span4 nav'>
            &lt;
            <a class='hide' id='past'>Past</a>
          </div>
          <div class='span4 nav' style='text-align:right'>
            <a class='hide' id='future'>Future</a>
            &gt;
          </div>
        </div>
      </div>
    </header>
    <div class='container'>
      <div id='blog_entry'>
  <div class='row headline'>
    <div class='span8'>
      <h1>How to import your project's history in Sonar</h1>
    </div>
  </div>
  <p>When you do your first <a href="http://sonarsource.org">Sonar</a> run on your project, you get a lot of new quality numbers to play with, but no trends. You only have one data set for comparison, the now picture.</p>

<p>Wouldn't it be nice if you could see the current trend of the project without waiting a couple of month for the 'daily/weekly' Sonar runs to fill up the data? Well, you're in luck! And if you're using git as a version system as well, this is your day. :)</p>

<p>In the <a href="http://docs.codehaus.org/display/SONAR/Advanced+parameters">Sonar Advanced Parameter</a> documentation you will find a System Property called <em>sonar.projectDate</em>. The property let you tell Sonar when in time the running analysis was ran.</p>

<p>By combining this property and what your version system does best, track changes to source, we can now play back the history of the project as far as Sonar is concerned.</p>

<p>This little Bash script illustrates the concept. To spell out what it does in human readable form:</p>

<blockquote><p>for each tag in the given git repository, checkout the source and run sonar, using the tag date as projectDate</p></blockquote>

<pre><code>GIT_REPO=$1&#x000A;START_TAG=$2&#x000A;&#x000A;MVN_COMMAND="mvn clean install"&#x000A;SONAR_COMMAND="mvn org.codehaus.sonar:sonar-maven3-plugin:3.0:sonar"&#x000A;&#x000A;if [ -z "$GIT_REPO" ]; then&#x000A;    echo "Missing program argument: repository"&#x000A;    echo "Usage: ./sonar_history.sh git_repository_path [start-tag]"&#x000A;    exit&#x000A;fi&#x000A;&#x000A;pushd $GIT_REPO&#x000A;for tag in `git tag`&#x000A;do&#x000A;    if [[ -n "$START_TAG" &amp;&amp; "$START_TAG" &gt; "$tag" ]] ; then&#x000A;        echo "Skipping $tag (start tag $START_TAG)"&#x000A;        continue&#x000A;    fi&#x000A;&#x000A;    TAG_DATE=`git show $tag --date=iso | grep Date: -m1 | cut -d' ' -f 4`&#x000A;    echo "Checking out source from $TAG_DATE tagged as $tag"&#x000A;    git checkout $tag  &gt; /dev/null 2&gt;&amp;1&#x000A;    git clean -df &gt; /dev/null 2&gt;&amp;1&#x000A;&#x000A;    SONAR_PROJECT_COMMAND="$SONAR_COMMAND -Dsonar.projectDate=$TAG_DATE"&#x000A;&#x000A;    echo "Executing Maven: $MVN_COMMAND"&#x000A;    $MVN_COMMAND &gt; /dev/null 2&gt;&amp;1&#x000A;    echo "Executing Sonar: $SONAR_PROJECT_COMMAND"&#x000A;    $SONAR_PROJECT_COMMAND &gt; /dev/null 2&gt;&amp;1&#x000A;done&#x000A;popd&#x000A;</code></pre>

<p>You can of course modify this script to fit your own need. Maybe you want to checkout the history pr week or pr month instead of using tags. It's up to you.</p>

<p>Have fun! :)</p>
</div>
    </div>
    <footer class='navbar navbar-fixed-bottom'>
      <div class='navbar-inner'>
        <div class='container'>
          <div class='span3' style='padding-top:5px'>
            <a href='http://arquillian.org'>
              <img src='/images/arquillian_icon_32px-glossy.png' />
            </a>
          </div>
        </div>
      </div>
    </footer>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    <script type='text/javascript'>
      $(window).load(function() { $('pre>code').addClass('prettify').parent().addClass('prettify'); prettify() })
    </script>
  </body>
</html>
<script>
  $(window).load(function() {
    $.ajax({
      url: '/api/blogs.json',
      dataType: 'json'
    }).done(function(data) {
  
      blogs = {
        data: data,
        container: "#blog_entry",
        future_link: "#future",
        past_link: "#past"
      }
      blogs.initialize = function(current_url) {
        this.data.current(current_url)
  
        if(this.data.hasPast()) {
          past = this.data.getPast()
          this.prepareNav(this.past_link, past.name, past.path)
        }
        else {
          this.prepareNav(this.past_link, "Index", "/index.html")
        }
        if(this.data.hasFuture()) {
          future = this.data.getFuture()
          this.prepareNav(this.future_link, future.name, future.path)
        }
        else {
          this.prepareNav(this.future_link, "Index", "/index.html")
        }
      }
      blogs.data.current = function(url) {
        this.current_url = url
      }
      blogs.data.hasPast = function() {
        var index = this.current_index()
        return index+1 <= (this.length-1)
      }
      blogs.data.getPast = function() {
        return this[this.current_index()+1]
      }
      blogs.data.hasFuture = function() {
        var index = this.current_index()
        return index-1 >= 0
      }
      blogs.data.getFuture = function() {
        return this[this.current_index()-1]
      }
      blogs.data.current_index = function() {
        for(i = 0; i < this.length; i++) {
          if(this[i].path == this.current_url) {
            return i;
          }
        }
        return -1
      }
      blogs.prepareNav = function(link, text, url) {
        $(link)
          .html(text)
          .fadeIn(500)
          .on().click(function() {
            blogs.load(url)
          })
      }
      blogs.load = function (url) {
        cont = this.container
        $(cont).slideUp('fast', function() {
          $(this).load(url + ' ' + cont, function() {
            $('pre>code').addClass('prettify')
              .parent().addClass('prettify');
            prettify();
            blogs.initialize(url)
            $(this).slideDown('fast');
          })
        })
      }
      blogs.initialize(window.location.pathname)
  
      $(window).keydown(function (e) {
        var keyCode = e.keyCode || e.which,
              arrow = {left: 37, right: 39};
  
        switch(keyCode) {
          case arrow.left:
            if(blogs.data.hasPast()) {
              blogs.load(blogs.data.getPast().path)
            }
            else {
              blogs.load("/index.html")
            }
          break;
          case arrow.right:
            if(blogs.data.hasFuture()) {
              blogs.load(blogs.data.getFuture().path)
            }
            else {
              blogs.load("/index.html")
            }
          break;
        }
      })
    })
  })
</script>
