<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Make Awestruct a blogger platform</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <style>
      body {
        padding-top: 60px;
        padding-bottom: 60px;
      }
    </style>
    <link href="/stylesheets/styles.css" rel="stylesheet" type="text/css">
    <link href="/stylesheets/prettify.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <script src=" https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js" type="text/javascript"></script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="col-md-4">
          <a class="navbar-brand" href="/">Aslak Knutsen</a>
        </div>
        <div class="col-md-4 nav">
          &lt;
          <a id="past">Past</a>
        </div>
        <div class="col-md-4 nav" style="text-align:right">
          <a id="future">Future</a>
          &gt;
        </div>
      </div>
    </nav>
    <div class="container">
      <div id="blog_entry">
        <div class="row headline">
          <div class="col-sm-10">
            <h1>Make Awestruct a blogger platform</h1>
          </div>
        </div>
        <p>Awestruct is a very nice dynamic static web site generation tool that has a powerful extension pipeline.</p>
        
        <p>Normally you will back your Awestruct site in a Git repository. You create a file on your local file system, commit it to the repository, regenerate the site and push it live. But we can take it one step further, why not have a simple web gui where you can write your blogs? What about GitHub Gists?</p>
        
        <h2>Awestruct::Extension::Gist</h2>
        
        <p>The setup is as easy as it get. Simply add the following to your pipeline.rb like this:</p>
        
        <pre><code>extension Awestruct::Extensions::Gist.new( &#39;username&#39;, &#39;password&#39; ) &#x000A;</code></pre>
        
        <p>The Gist extension will now fetch all Gists via GitHubs REST API, select the Gists that contain a file that match blog.*. The rest of the Gists are ignored. The blog Gist is added to the normal site.pages array. </p>
        
        <p>The Gist page will have this metadata associated with it:</p>
        
        <pre><code>page.author = gist[&quot;user&quot;][&quot;login&quot;]&#x000A;page.date = gist[&quot;created_at&quot;]&#x000A;page.title = gist[&quot;description&quot;]&#x000A;page.gist_source = gist[&quot;html_url&quot;]&#x000A;page.relative_source_path = &quot;#\{@output\}/#\{gist[&#39;id&#39;]\}.html&quot;&#x000A;page.layout = &quot;blog&quot;&#x000A;</code></pre>
        
        <p>If we later in the pipeline add the Posts extension, our Gist blog will get picked up and processed like any other blog post. </p>
        
        <pre><code>extension Awestruct::Extensions::Posts.new( &#39;/blog&#39; ) &#x000A;</code></pre>
        
        <p>The markup engine used to render the Gist is based on the blog file extension. Any markup supported by Awestruct can be used, e.g. blog.md, blog.textile, blog.asciidoc.</p>
        
        <p>Pretty neat! Now we have online edit support </p>
      </div>
    </div>
    <nav class="navbar navbar-default navbar-fixed-bottom">
      <div class="container-fluid">
        <div class="col-md-3" style="padding-top:5px">
          <a href="http://arquillian.org">
            <img src="/images/arquillian_icon_32px-glossy.png">
          </a>
        </div>
      </div>
    </nav>
    <script src="/javascripts/prettify.js" type="text/javascript"></script>
    <script type="text/javascript">
      $(window).load(function() { $('pre>code').addClass('prettify').parent().addClass('prettify'); prettify() })
    </script>
    <script>
      $(window).load(function() {
        $.ajax({
          url: '/api/blogs.json',
          dataType: 'json'
        }).done(function(data) {
      
          blogs = {
            data: data,
            container: "#blog_entry",
            future_link: "#future",
            past_link: "#past"
          }
          blogs.initialize = function(current_url) {
            this.data.current(current_url)
      
            if(this.data.hasPast()) {
              past = this.data.getPast()
              this.prepareNav(this.past_link, past.name, past.path)
            }
            else {
              this.prepareNav(this.past_link, "Index", "/index.html")
            }
            if(this.data.hasFuture()) {
              future = this.data.getFuture()
              this.prepareNav(this.future_link, future.name, future.path)
            }
            else {
              this.prepareNav(this.future_link, "Index", "/index.html")
            }
          }
          blogs.data.current = function(url) {
            this.current_url = url
          }
          blogs.data.hasPast = function() {
            var index = this.current_index()
            return index+1 <= (this.length-1)
          }
          blogs.data.getPast = function() {
            return this[this.current_index()+1]
          }
          blogs.data.hasFuture = function() {
            var index = this.current_index()
            return index-1 >= 0
          }
          blogs.data.getFuture = function() {
            return this[this.current_index()-1]
          }
          blogs.data.current_index = function() {
            for(i = 0; i < this.length; i++) {
              if(this[i].path == this.current_url) {
                return i;
              }
            }
            return -1
          }
          blogs.prepareNav = function(link, text, url) {
            $(link)
              .html(text)
              .fadeIn(500)
              .on().click(function() {
                blogs.load(url)
              })
          }
          blogs.load = function (url) {
            cont = this.container
            $(cont).slideUp('fast', function() {
              $(this).load(url + ' ' + cont, function() {
                $('pre>code').addClass('prettify')
                  .parent().addClass('prettify');
                prettify();
                blogs.initialize(url)
                $(this).slideDown('fast');
              })
            })
          }
          blogs.initialize(window.location.pathname)
      
          $(window).keydown(function (e) {
            var keyCode = e.keyCode || e.which,
                  arrow = {left: 37, right: 39};
      
            switch(keyCode) {
              case arrow.left:
                if(blogs.data.hasPast()) {
                  blogs.load(blogs.data.getPast().path)
                }
                else {
                  blogs.load("/index.html")
                }
              break;
              case arrow.right:
                if(blogs.data.hasFuture()) {
                  blogs.load(blogs.data.getFuture().path)
                }
                else {
                  blogs.load("/index.html")
                }
              break;
            }
          })
        })
      })
    </script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount','UA-38014373-1']);
    _gaq.push(['_trackPageview']);
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>
